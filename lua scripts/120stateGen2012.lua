-- Run 2012 120 TAS with this lua to generate states for all stars

local PATH = debug.getinfo(1).source:sub(2):match("(.*\\)")
local files = {[2137]="1 CCM Wall Kicks Will Work",[2794]="2 CCM Slip Slidin' Away",[3937]="3 CCM 100c+Big Penguin Race",[6641]="5 CCM Frosty Slide for 8 Red Coins",[8132]="6 CCM Li'l Penguin Lost",[9028]="7 CCM Snowman's Lost His Head",[10582]="8 PSS Under 21",[11657]="9 BitDW",[14051]="10 PSS Box",[15070]="11 TotWC",[16207]="12 WF Blast Away the Wall",[16875]="13 WF Fall onto the Caged Island",[17561]="14 WF 100c+Red Coins on the Floating Isle",[19583]="16 WF Chip Off Whomp's Block",[20822]="17 WF To the Top of the Fortress",[21549]="18 WF Shoot into the Wild Blue",[22391]="19 BoB Find the 8 Red Coins",[23717]="20 BoB Mario Wings to the Sky",[24782]="21 BoB Big Bob-omb on the Summit",[26264]="22 BoB 100c+Footrace with Koopa the Quick",[29537]="24 BoB Shoot to the Island in the Sky",[30379]="25 BoB Behind Chain Chomp's Gate",[31516]="26 DDD 100c+Pole-Jumping for Red Coins",[34800]="28 DDD Chests in the Current",[36018]="29 DDD Collect the Caps",[37781]="30 DDD Through the Jet Stream",[39302]="31 DDD Board Bowser's Sub",[40712]="32 DDD The Manta Ray's Reward",[41494]="33 BitFS",[45562]="36 HMC Metal-Head Mario Can Move!",[46512]="37 HMC A-Maze-ing Emergency Exit",[47258]="38 HMC Watch for Rolling Rocks",[48106]="39 HMC 100c+Elevate for 8 Red Coins",[51572]="41 HMC Swimming Beast in the Cavern",[52443]="42 CotMC",[54169]="43 HMC Navigating the Toxic Maze",[55071]="44 SSL 100c+Pyramid Puzzle",[57960]="46 SSL Shining Atop the Pyramid",[58549]="47 SSL Stand Tall on the Four Pillars",[60365]="48 SSL In the Talons of the Big Bird",[61170]="49 SSL Inside the Ancient Pyramid",[61930]="50 SSL Free Flying for 8 Red Coins",[63512]="51 LLL Elevator Tour in the Volcano",[64445]="52 LLL Boil the Big Bully",[65280]="53 LLL Red-Hot Log Rolling",[65908]="54 LLL 8-Coin Puzzle with 15 Pieces",[66710]="55 LLL Bully the Bullies",[67662]="56 LLL 100c+Hot-Foot-It into the Volcano",[70969]="59 VCutM",[72378]="60 JRB Treasure of the Ocean Cave",[73341]="61 JRB Blast to the Stone Pillar",[74103]="62 JRB Plunder in the Sunken Ship",[75446]="63 JRB 100c+Red Coins on the Ship Afloat",[78273]="65 JRB Through the Jet Stream",[78944]="66 JRB Can the Eel Come Out to Play",[80063]="67 SA",[82004]="68 BBH Go On a Ghost Hunt",[83737]="69 BBH Big Boo's Balcony",[84946]="70 BBH Eye to Eye in the Secret Room",[86307]="71 BBH Secret of the Haunted Books",[87164]="72 BBH 100c+Ride Big Boo's Merry-Go-Round",[90119]="74 BBH Seek the 8 Red Coins",[91994]="75 THI 100c+Wiggler's Red Coins",[94476]="77 THI The Tip Top of the Huge Island",[95382]="78 THI Five Itty Bitty Secrets",[96314]="79 THI Pluck the Piranha Flower",[97434]="80 THI Rematch with Koopa the Quick",[99121]="81 THI Make Wiggler Squirm",[100848]="82 SL In the Deep Freeze",[101418]="83 SL Whirl from the Freezing Pond",[102205]="84 SL Chill with the Bully",[102970]="85 SL Snowman's Big Head",[103619]="86 SL Into the Igloo",[104426]="87 SL 100c+Shell Shreddin' for Red Coins",[107526]="90 TTM Breathtaking View from Bridge",[108245]="91 TTM Mysterious Mountainside",[108858]="92 TTM 100c+Scary 'Shrooms, Red Coins",[111938]="94 TTM Scale the Mountain",[112689]="95 TTM Mystery of the Monkey Cage",[113891]="96 TTM Blast to the Lonely Mushroom",[114541]="97 WDW Secrets in the Shallows & Sky",[115783]="98 WDW Top O' the Town",[116559]="99 WDW 100c+Go to Town for Red Coins",[119388]="101 WDW Shocking Arrow Lifts!",[120147]="102 WDW Express Elevator--Hurry Up!",[120769]="103 WDW Quick Race Through Downtown!",[122213]="104 WMotR",[124230]="105 TTC Stop Time for Red Coins",[125045]="106 TTC 100c+Stomp on the Thwomp",[126957]="108 TTC Get a Hand",[127540]="109 TTC The Pit and the Pendulums",[128203]="110 TTC Timed Jumps on Moving Bars",[128976]="111 TTC Roll into the Cage",[130010]="113 RR Cruiser Crossing the Rainbow",[130896]="114 RR The Big House in the Sky",[132511]="115 RR 100c+Somewhere Over the Rainbow",[135041]="117 RR Tricky Triangles!",[135743]="118 RR Swingin' in the Breeze",[136510]="119 RR Coins Amassed in a Maze",[137663]="120 BitS",[12817]="Bowser 1",[43140]="Bowser 2",[139335]="Bowser 3"}
local global_timer_last = -1

function stateCheck()
	local gt = memory.readdword(0x8032D5D4)
	if (gt == global_timer_last) then
		return
	end
	global_timer_last = gt

	local filename = files[gt]
	if filename then
		local st_path = string.format("%s/120states/%s.st", PATH, filename)
		savestate.savefile(st_path)
	end
end

emu.atinput(stateCheck)